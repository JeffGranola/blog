#! /bin/sh

set -eu

MY_DIR="$(CDPATH='' cd "$(dirname "$0")" && pwd)"

echo "Testing prerequisites..."
"$MY_DIR"/dev/test-dev-env
echo "... prerequisites tested."
echo

echo "Building CSS and JavaScript via Yarn and NPM..."
( cd "$MY_DIR"/hugo/theme-src  && ./build )
echo "... CSS and JavaScript code built."
echo

echo "Invoking hugo..."
(cd "$MY_DIR"/hugo && rm -fr public && HUGO_ENV='production' hugo)
# ^ Setting HUGO_ENV=production is required to generate the robots.txt file and
#   for enabling Google Analytics.
echo "... done."
